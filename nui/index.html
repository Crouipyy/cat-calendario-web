<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Escolar - Hogwarts</title>
    <link rel="stylesheet" href="/nui/style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“… Calendario Escolar Hogwarts</h1>
            <button id="btnCerrar" class="btn-cerrar">âœ•</button>
        </div>

        <!-- Selector de Semanas -->
        <div class="semanas-selector">
            <button class="btn-semana" data-semana="1">1Âº Semana</button>
            <button class="btn-semana" data-semana="2">2Âº Semana</button>
        </div>

        <!-- Calendario con scroll -->
        <div id="calendario" class="calendario">
            <!-- Se llena dinÃ¡micamente con JavaScript -->
        </div>

        <!-- Botones de acciÃ³n -->
        <div class="acciones">
            <button id="btnGuardar" class="btn-guardar" style="display: none;">ğŸ’¾ Guardar Cambios</button>
            <button id="btnCerrar2" class="btn-cerrar">Cerrar</button>
            <button id="btnProbarClimas" class="btn-guardar" style="background: #6f42c1;">ğŸ§ª Probar Climas</button> 
        </div>
    </div>

    <!-- Modal para editar clase MEJORADO -->
    <div id="modalClase" class="modal">
        <div class="modal-content">
            <h3>ğŸ“š Crear/Editar Clase</h3>
            <form id="formClase">
                <input type="hidden" id="modalSemana">
                <input type="hidden" id="modalDia">
                <input type="hidden" id="modalHorario">
                <input type="hidden" id="modalClaseIndex">
                
                <div class="form-group">
                    <label>TÃ­tulo de la Clase:</label>
                    <input type="text" id="tituloClase" maxlength="50" placeholder="Ej: Pociones Avanzadas" required>
                </div>
                
                <div class="form-group">
                    <label>DescripciÃ³n:</label>
                    <textarea id="descripcionClase" maxlength="200" placeholder="DescripciÃ³n de la clase..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Profesor:</label>
                    <input type="text" id="profesorClase" maxlength="30" placeholder="Nombre del profesor" required>
                </div>
                
                <div class="form-group">
                    <label>Hora dentro de la franja:</label>
                    <div id="horaExactaClase">
                        <!-- Se llena dinÃ¡micamente con opciones disponibles -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Cursos:</label>
                    <div class="cursos-selector" id="cursosSelector">
                        <!-- Se llena dinÃ¡micamente -->
                    </div>
                </div>
                
                <div class="modal-botones">
                    <button type="submit" class="btn-guardar">ğŸ’¾ Guardar Clase</button>
                    <button type="button" id="btnCancelar" class="btn-cerrar">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para editar meses -->
    <div id="modalMeses" class="modal">
        <div class="modal-content">
            <h3>ğŸ“… Editar Meses</h3>
            <form id="formMeses">
                <input type="hidden" id="modalMesesSemana">
                
                <div class="form-group">
                    <label>Selecciona los meses para cada dÃ­a:</label>
                    <div id="mesesSelector">
                        <!-- Se llena dinÃ¡micamente -->
                    </div>
                </div>
                
                <div class="modal-botones">
                    <button type="submit" class="btn-guardar">ğŸ’¾ Guardar Meses</button>
                    <button type="button" id="btnCancelarMeses" class="btn-cerrar">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NUEVO: Modal para editar clima y eventos -->
    <div id="modalClima" class="modal">
        <div class="modal-content">
            <h3>ğŸŒ¤ï¸ Editar InformaciÃ³n del DÃ­a</h3>
            <form id="formClima">
                <input type="hidden" id="modalClimaSemana">
                <input type="hidden" id="modalClimaDia">
                
                <div class="form-group">
                    <label>Temperatura para Roleo (Â°C):</label>
                    <input type="number" id="temperaturaClima" min="-50" max="50" step="1" required>
                    <small>Solo para informaciÃ³n visual en el calendario</small>
                </div>
                
                <div class="form-group">
                    <label>Fase Lunar:</label>
                    <select id="lunaClima" required>
                        <!-- Se llena dinÃ¡micamente -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Evento Especial:</label>
                    <select id="eventoClima">
                        <!-- Se llena dinÃ¡micamente -->
                    </select>
                </div>

                <div class="form-group">
                    <label>InformaciÃ³n del Sistema de Clima AutomÃ¡tico:</label>
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-size: 12px;">
                        <strong>El clima se controla automÃ¡ticamente por horarios</strong><br>
                        â€¢ Los profesores pueden usar: <code>/cambiarclima [tipo]</code><br>
                        â€¢ Ver horarios: <code>/horariosclima</code>
                    </div>
                </div>

                <div class="modal-botones">
                    <button type="submit" class="btn-guardar">ğŸ’¾ Guardar InformaciÃ³n</button>
                    <button type="button" id="btnCancelarClima" class="btn-cerrar">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NUEVO: Modal para confirmar eliminaciÃ³n -->
    <div id="modalEliminar" class="modal">
        <div class="modal-content">
            <h3>ğŸ—‘ï¸ Eliminar Clase</h3>
            <p id="textoEliminar">Â¿EstÃ¡s seguro de que quieres eliminar esta clase?</p>
            
            <div class="modal-botones">
                <button id="btnConfirmarEliminar" class="btn-eliminar">âœ… SÃ­, Eliminar</button>
                <button id="btnCancelarEliminar" class="btn-cerrar">âŒ Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modalEvento" class="modal">
        <div class="modal-content">
            <h3>ğŸª Crear Evento</h3>
            <form id="formEvento">
                <input type="hidden" id="modalEventoSemana">
                <input type="hidden" id="modalEventoDia">
                <input type="hidden" id="modalEventoHorario">
                <input type="hidden" id="modalEventoIndex" value="0">
                
                <div class="form-group">
                    <label>Texto del Evento:</label>
                    <input type="text" id="textoEvento" maxlength="50" placeholder="Ej: Torneo de Quidditch" required>
                </div>
                
                <!-- NUEVO: Selector de color personalizado para eventos -->
                <div class="form-group">
                    <label>Color de Fondo:</label>
                    <div class="color-selector">
                        <input type="color" id="colorFondoEventoPicker" value="#fff3cd">
                        <input type="text" id="colorFondoEventoHex" placeholder="#fff3cd" maxlength="7">
                        <div class="color-preview" id="colorFondoEventoPreview"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Color de Texto:</label>
                    <div class="color-selector">
                        <input type="color" id="colorTextoEventoPicker" value="#000000">
                        <input type="text" id="colorTextoEventoHex" placeholder="#000000" maxlength="7">
                        <div class="color-preview" id="colorTextoEventoPreview"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="cursivaEvento">
                        Texto en Cursiva
                    </label>
                </div>
                
                <div class="modal-botones">
                    <button type="submit" class="btn-guardar">ğŸ’¾ Guardar Evento</button>
                    <button type="button" id="btnCancelarEvento" class="btn-cerrar">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para crear/editar separador -->
    <div id="modalSeparador" class="modal">
        <div class="modal-content">
            <h3>ğŸ“ Crear Separador</h3>
            <form id="formSeparador">
                <input type="hidden" id="modalSeparadorHorario">
                
                <div class="form-group">
                    <label>Texto del Separador:</label>
                    <select id="textoSeparador">
                        <option value="">Sin separador</option>
                        <!-- Se llena dinÃ¡micamente -->
                    </select>
                    <small>O escribe uno personalizado:</small>
                    <input type="text" id="textoSeparadorPersonalizado" maxlength="50" placeholder="Texto personalizado">
                </div>
                
                <!-- MEJORADO: OpciÃ³n para mostrar hora en el separador -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="mostrarHoraSeparador">
                        Mostrar horario en el separador
                    </label>
                    <small>Si se activa, el separador mostrarÃ¡ la franja horaria a la izquierda</small>
                </div>

                <!-- MEJORADO: Campos para horario personalizado con minutos -->
                <div class="form-group" id="grupoHorarioPersonalizado" style="display: none;">
                    <label>Horario Personalizado:</label>
                    <div class="horario-personalizado">
                        <div class="hora-input-group">
                            <label>Hora Inicio:</label>
                            <input type="time" id="horaInicioSeparador" step="60">
                        </div>
                        <div class="hora-input-group">
                            <label>Hora Fin:</label>
                            <input type="time" id="horaFinSeparador" step="60">
                        </div>
                    </div>
                    <small>Permite configurar horas y minutos. Deja en blanco para usar la hora de la fila actual.</small>
                </div>
                
                <div class="form-group">
                    <label>Color de Fondo:</label>
                    <div class="color-selector">
                        <input type="color" id="colorFondoSeparadorPicker" value="#740001">
                        <input type="text" id="colorFondoSeparadorHex" placeholder="#740001" maxlength="7">
                        <div class="color-preview" id="colorFondoPreview"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Color de Texto:</label>
                    <div class="color-selector">
                        <input type="color" id="colorTextoSeparadorPicker" value="#ffffff">
                        <input type="text" id="colorTextoSeparadorHex" placeholder="#ffffff" maxlength="7">
                        <div class="color-preview" id="colorTextoPreview"></div>
                    </div>
                </div>
                
                <div class="modal-botones">
                    <button type="submit" class="btn-guardar">ğŸ’¾ Guardar Separador</button>
                    <button type="button" id="btnCancelarSeparador" class="btn-cerrar">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para confirmar eliminaciÃ³n de separador -->
    <div id="modalEliminarSeparador" class="modal">
        <div class="modal-content">
            <h3>ğŸ—‘ï¸ Eliminar Separador</h3>
            <p id="textoEliminarSeparador">Â¿EstÃ¡s seguro de que quieres eliminar este separador?</p>
            
            <div class="modal-botones">
                <button id="btnConfirmarEliminarSeparador" class="btn-eliminar">âœ… SÃ­, Eliminar</button>
                <button id="btnCancelarEliminarSeparador" class="btn-cerrar">âŒ Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para editar clima por franja horaria - SIMPLIFICADO -->
    <div id="modalClimaHorario" class="modal">
        <div class="modal-content">
            <h3>ğŸŒ¤ï¸ Editar Clima</h3>
            <form id="formClimaHorario">
                <input type="hidden" id="modalClimaHorarioFranja">
                
                <div class="form-group">
                    <label>Franja Horaria:</label>
                    <div id="infoFranjaHoraria" style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-weight: bold; text-align: center;"></div>
                </div>
                
                <div class="form-group">
                    <label>Selecciona el clima:</label>
                    <select id="climaHorarioSelect" required style="width: 100%; padding: 10px; font-size: 14px;">
                        <!-- Se llena dinÃ¡micamente -->
                    </select>
                </div>

                <div class="modal-botones">
                    <button type="submit" class="btn-guardar">ğŸ’¾ Guardar Clima</button>
                    <button type="button" id="btnCancelarClimaHorario" class="btn-cerrar">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalProbarClimas" class="modal">
        <div class="modal-content">
            <h3>ğŸ§ª Probar Sistema de Climas</h3>
            
            <div class="form-group">
                <label>Selecciona una hora para probar:</label>
                <input type="time" id="horaPruebaClima" value="" step="60" style="width: 100%; padding: 10px; font-size: 16px;">
            </div>

            <div class="form-group">
                <label>Clima que se activarÃ­a:</label>
                <div id="resultadoClimaPrueba" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-weight: bold; text-align: center; font-size: 18px;">
                    Selecciona una hora...
                </div>
            </div>

            <div class="form-group">
                <label>ConfiguraciÃ³n actual de climas:</label>
                <div style="background: #e9ecef; padding: 10px; border-radius: 5px; font-size: 12px; max-height: 200px; overflow-y: auto;">
                    <div id="listaClimasConfigurados">
                        <!-- Se llena dinÃ¡micamente -->
                    </div>
                </div>
            </div>

            <div class="modal-botones">
                <button type="button" id="btnAplicarClimaPrueba" class="btn-guardar">ğŸŒ¤ï¸ Aplicar Este Clima</button>
                <button type="button" id="btnCerrarProbarClimas" class="btn-cerrar">âŒ Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal para gestionar barras de estaciÃ³n -->
    <div id="modalBarrasEstacion" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h3>ğŸŒ¸ Gestionar Barras de EstaciÃ³n</h3>
            <input type="hidden" id="modalBarrasSemana">
            
            <div class="form-group">
                <label>Barras actuales para esta semana:</label>
                <div id="listaBarrasEstacion" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px; min-height: 60px;">
                    <!-- Se llena dinÃ¡micamente -->
                </div>
            </div>

            <div class="form-group">
                <button type="button" id="btnAgregarBarra" class="btn-guardar" style="width: 100%;">+ Agregar Nueva Barra de EstaciÃ³n</button>
            </div>

            <div class="modal-botones">
                <button type="button" id="btnCerrarBarrasEstacion" class="btn-cerrar">âŒ Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal para editar/crear una barra de estaciÃ³n -->
    <div id="modalEditarBarra" class="modal">
        <div class="modal-content">
            <h3 id="tituloModalBarra">ğŸ“ Editar Barra de EstaciÃ³n</h3>
            <form id="formEditarBarra">
                <input type="hidden" id="modalBarraIndex">
                
                <div class="form-group">
                    <label>EstaciÃ³n:</label>
                    <select id="estacionBarra" required style="width: 100%; padding: 10px; font-size: 14px;">
                        <option value="Primavera">ğŸŒ¸ Primavera (Spring)</option>
                        <option value="Verano">â˜€ï¸ Verano (Summer)</option>
                        <option value="OtoÃ±o">ğŸ‚ OtoÃ±o (Autumn)</option>
                        <option value="Invierno">â„ï¸ Invierno (Winter)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>DÃ­a de Inicio (0 = Primer dÃ­a, 6 = Ãšltimo dÃ­a):</label>
                    <input type="number" id="diaInicioBarra" min="0" max="6" required style="width: 100%; padding: 10px;">
                </div>
                
                <div class="form-group">
                    <label>DuraciÃ³n (dÃ­as):</label>
                    <input type="number" id="diasDuracionBarra" min="1" max="7" required style="width: 100%; padding: 10px;">
                    <small>CuÃ¡ntos dÃ­as consecutivos abarca esta barra</small>
                </div>

                <div class="form-group">
                    <label>Vista previa:</label>
                    <div id="vistaPreviewBarra" style="position: relative; height: 50px; background: #e9ecef; border-radius: 8px; margin-top: 10px; overflow: hidden;">
                        <div style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; display: flex;">
                            <div style="flex: 1; border-right: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 10px;">D0</div>
                            <div style="flex: 1; border-right: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 10px;">D1</div>
                            <div style="flex: 1; border-right: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 10px;">D2</div>
                            <div style="flex: 1; border-right: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 10px;">D3</div>
                            <div style="flex: 1; border-right: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 10px;">D4</div>
                            <div style="flex: 1; border-right: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 10px;">D5</div>
                            <div style="flex: 1; display: flex; align-items: center; justify-content: center; font-size: 10px;">D6</div>
                        </div>
                        <div id="barraPreview" style="position: absolute; height: 100%; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.3); transition: all 0.3s;">
                        </div>
                    </div>
                </div>
                
                <div class="modal-botones">
                    <button type="submit" class="btn-guardar">ğŸ’¾ Guardar Barra</button>
                    <button type="button" id="btnCancelarEditarBarra" class="btn-cerrar">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de confirmaciÃ³n para eliminar barra -->
    <div id="modalConfirmarEliminarBarra" class="modal">
        <div class="modal-content">
            <h3>ğŸ—‘ï¸ Eliminar Barra de EstaciÃ³n</h3>
            <p id="textoConfirmarEliminarBarra" style="text-align: center; font-size: 16px; margin: 20px 0;">
                Â¿EstÃ¡s seguro de que quieres eliminar esta barra de estaciÃ³n?
            </p>
            
            <div class="modal-botones">
                <button id="btnConfirmarEliminarBarra" class="btn-eliminar">âœ… SÃ­, Eliminar</button>
                <button id="btnCancelarEliminarBarra" class="btn-cerrar">âŒ Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Script para modo web (debe ejecutarse ANTES de script.js) -->
    <script>
        // Detectar si estamos en modo web (si no estÃ¡ definido, lo definimos)
        if (typeof window.MODO_WEB === 'undefined') {
            // Si estamos en Vercel o fuera de FiveM
            if (typeof GetParentResourceName === 'undefined' || window.location.protocol === 'http:' || window.location.protocol === 'https:') {
                window.MODO_WEB = true;
                // Obtener URL base automÃ¡ticamente
                window.API_URL = window.location.origin;
                console.log('[HTML] Modo web detectado, API_URL:', window.API_URL);
            } else {
                window.MODO_WEB = false;
                console.log('[HTML] Modo FiveM detectado');
            }
        }
    </script>
    <script src="/nui/script.js"></script>
</body>
</html>